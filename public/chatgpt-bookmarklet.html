<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ChatGPT Prompt Template Insert Bookmarklet Generator</title>

  <style>
    :root{
      --bg: #ffffff;
      --panel: #ffffff;
      --text: #0f172a;       /* slate-900 */
      --muted: #475569;      /* slate-600 */
      --border: #e2e8f0;     /* slate-200 */
      --shadow: 0 12px 30px rgba(15, 23, 42, 0.08);
      --shadow-sm: 0 6px 18px rgba(15, 23, 42, 0.06);
      --ring: rgba(59,130,246,0.28); /* blue-500 */
      --accent: #2563eb;     /* blue-600 */
      --accent2: #1d4ed8;    /* blue-700 */
      --success: #16a34a;    /* green-600 */
      --success-bg: rgba(22,163,74,0.08);
      --danger: #dc2626;     /* red-600 */
      --danger-bg: rgba(220,38,38,0.08);
      --radius: 16px;
      --radius-sm: 12px;
      --font: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin: 0;
      font-family: var(--font);
      background: var(--bg);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .container{
      max-width: 980px;
      margin: 0 auto;
      padding: 28px 18px 40px;
    }

    .header{
      display: flex;
      align-items: flex-start;
      justify-content: flex-start;
      gap: 16px;
      margin-bottom: 18px;
    }

    .title{
      margin: 0;
      font-size: clamp(20px, 3vw, 28px);
      letter-spacing: -0.02em;
      line-height: 1.2;
    }

    .subtitle{
      margin: 8px 0 0;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.6;
      max-width: 62ch;
    }

    .grid{
      display: grid;
      gap: 16px;
    }
    .card{
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .card-header{
      padding: 16px 16px 0;
    }

    .card-title{
      margin: 0;
      font-size: 14px;
      letter-spacing: 0.01em;
      color: var(--muted);
      font-weight: 600;
      text-transform: uppercase;
    }

    .card-body{
      padding: 14px 16px 16px;
    }

    label{
      display: block;
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 8px;
    }

    textarea{
      width: 100%;
      min-height: 180px;
      resize: vertical;
      padding: 12px 12px;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      font: 14px/1.6 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      color: var(--text);
      background: #fff;
      outline: none;
      transition: box-shadow .15s ease, border-color .15s ease, transform .15s ease;
    }
    textarea:focus{
      border-color: rgba(37,99,235,0.55);
      box-shadow: 0 0 0 4px var(--ring);
    }

    .row{
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin-top: 12px;
    }

    .btn{
      appearance: none;
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 10px 14px;
      font-size: 14px;
      line-height: 1;
      background: #fff;
      color: var(--text);
      cursor: pointer;
      transition: transform .08s ease, box-shadow .15s ease, border-color .15s ease, background .15s ease;
      user-select: none;
    }
    .btn:hover{
      border-color: rgba(37,99,235,0.40);
      box-shadow: 0 10px 22px rgba(37,99,235,0.10);
    }
    .btn:active{
      transform: translateY(1px);
    }
    .btn-primary{
      background: linear-gradient(180deg, rgba(37,99,235,0.96), rgba(29,78,216,0.96));
      color: #fff;
      border-color: rgba(37,99,235,0.55);
      box-shadow: 0 12px 26px rgba(37,99,235,0.18);
    }
    .btn-primary:hover{
      box-shadow: 0 16px 34px rgba(37,99,235,0.22);
      border-color: rgba(37,99,235,0.70);
    }

    .btn-ghost{
      background: #fff;
      color: var(--muted);
    }

    .help{
      margin: 10px 0 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.6;
    }

    .pill{
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      border: 1px dashed var(--border);
      border-radius: 14px;
      background: #fff;
    }

    .bookmarklet-link{
      display: inline-flex;
      align-items: center;
      gap: 10px;
      text-decoration: none;
      font-weight: 600;
      color: var(--accent2);
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(37,99,235,0.25);
      background: rgba(37,99,235,0.05);
      transition: box-shadow .15s ease, transform .08s ease, border-color .15s ease;
    }
    .bookmarklet-link:hover{
      border-color: rgba(37,99,235,0.45);
      box-shadow: 0 12px 26px rgba(37,99,235,0.12);
    }
    .bookmarklet-link:active{
      transform: translateY(1px);
    }

    .status{
      margin-top: 12px;
      font-size: 13px;
      border-radius: 12px;
      padding: 10px 12px;
      border: 1px solid var(--border);
      background: #fff;
      color: var(--muted);
      display: none;
    }
    .status.ok{
      display: block;
      border-color: rgba(22,163,74,0.35);
      background: var(--success-bg);
      color: #166534;
    }
    .status.err{
      display: block;
      border-color: rgba(220,38,38,0.35);
      background: var(--danger-bg);
      color: #991b1b;
    }

    .footer-note{
      margin-top: 14px;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.6;
    }

    .sr-only{
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <div>
        <h1 class="title">ChatGPT Prompt Template Insert Bookmarklet Generator</h1>
        <p class="subtitle">
          Paste your prompt template, generate a bookmarklet, then drag the bookmarklet link to your browser’s bookmarks bar.
        </p>
      </div>
    </div>

    <div class="grid">
      <!-- Left: Input -->
      <section class="card" aria-labelledby="input-title">
        <div class="card-header">
          <h2 class="card-title" id="input-title">Prompt Template</h2>
        </div>
        <div class="card-body">
          <label for="inputText">Input Prompt Template</label>
          <textarea id="inputText" placeholder="Input Prompt Template Here"></textarea>

          <div class="row">
            <button class="btn btn-primary" onclick="convert()" id="generateBtn">Generate Bookmarklet</button>
            <button class="btn btn-ghost" onclick="clearAll()">Clear</button>
          </div>

          <p class="help">
            Tip: Keep your template readable. Each new line will be inserted as a new paragraph in the ChatGPT input area.
          </p>

          <div id="statusBox" class="status" role="status" aria-live="polite"></div>
        </div>
      </section>

      <!-- Right: Output -->
      <section class="card" aria-labelledby="output-title">
        <div class="card-header">
          <h2 class="card-title" id="output-title">Bookmarklet</h2>
        </div>
        <div class="card-body">
          <div class="pill" style="width: 100%; justify-content: space-between; gap: 12px;">
            <a href="about:blank" id="outputAnchor" class="bookmarklet-link" draggable="true">
              <span aria-hidden="true">↗</span>
              <span>bookmarklet</span>
            </a>

            <button class="btn" onclick="copyBookmarklet()" id="copyBtn" disabled>
              Copy URL
            </button>
          </div>

          <div style="display: none;" id="workDiv"></div>

          <div style="margin-top: 12px;">
            <label for="outputText">Bookmarklet URL</label>
            <textarea id="outputText" placeholder="Bookmarklet Here" readonly></textarea>
          </div>

          <div class="footer-note">
            If the bookmarklet does nothing, ensure you are on the ChatGPT page and the message input exists as <code>#prompt-textarea</code>.
          </div>
        </div>
      </section>
    </div>
  </div>

  <script>
    function setStatus(type, message) {
      const box = document.getElementById("statusBox");
      box.className = "status " + (type === "ok" ? "ok" : "err");
      box.textContent = message;
    }

    function clearStatus() {
      const box = document.getElementById("statusBox");
      box.className = "status";
      box.textContent = "";
    }

    function clearAll() {
      document.getElementById("inputText").value = "";
      document.getElementById("outputText").value = "";
      const a = document.getElementById("outputAnchor");
      a.href = "about:blank";
      document.getElementById("copyBtn").disabled = true;
      clearStatus();
    }

    function convert() {
      clearStatus();

      const input = document.getElementById("inputText").value;

      if (!input.trim()) {
        setStatus("err", "Please input a prompt template first.");
        return;
      }

      const jsCode =
        "!async function(){const sleep=msec=>new Promise(r=>setTimeout(r,msec));" +
        "const promptTextarea=document.querySelector(\"#prompt-textarea\");" +
        "if(!promptTextarea){alert(\"#prompt-textarea not found. Open ChatGPT and click into the message box first.\");return;}" +
        "const childNodesSaved=Array.from(promptTextarea.childNodes);" +
        "const promptInputList=" + JSON.stringify(input.split(/\r?\n/)) + ";" +
        "for(const promptLine of promptInputList){const p=document.createElement(\"p\");" +
        "if(\"\"==promptLine){const br=document.createElement(\"br\");p.appendChild(br)}" +
        "else p.textContent=promptLine;promptTextarea.appendChild(p)}" +
        "for(const childNodeSaved of childNodesSaved){promptTextarea.removeChild(childNodeSaved);promptTextarea.appendChild(childNodeSaved);}" +
        "await sleep(0);promptTextarea.lastChild&&promptTextarea.lastChild.scrollIntoView();}();";

      const bookmarkletUrl =
        "javascript:" + jsCode.replaceAll("%", "%25").replaceAll("\"", "%22");

      document.getElementById("outputText").value = bookmarkletUrl;

      const outputAnchor = document.getElementById("outputAnchor");
      outputAnchor.href = bookmarkletUrl;

      document.getElementById("copyBtn").disabled = false;
      setStatus("ok", "Generated. Drag the “bookmarklet” link to your bookmarks bar, or copy the URL.");
    }

    async function copyBookmarklet() {
      const text = document.getElementById("outputText").value;
      if (!text) return;

      try {
        await navigator.clipboard.writeText(text);
        setStatus("ok", "Copied to clipboard.");
      } catch (e) {
        // Fallback
        const output = document.getElementById("outputText");
        output.focus();
        output.select();
        document.execCommand("copy");
        setStatus("ok", "Copied to clipboard (fallback).");
      }
    }
  </script>
</body>
</html>

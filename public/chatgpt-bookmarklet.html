<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ChatGPT Prompt Template Insert Bookmarklet Generator</title>

  
  <link rel="stylesheet" href="style.css" />
  <script defer src="theme-selector.js"></script>
</head>

<body class="theme-root page-body">
  <main class="page-main">
<div class="container">
    <div class="header">
      <div>
        <h1 class="title">ChatGPT Prompt Template Insert Bookmarklet Generator</h1>
        <p class="subtitle">
          Paste your prompt template, generate a bookmarklet, then drag the bookmarklet link to your browser’s bookmarks bar.
        </p>
      </div>
      <div class="badge" aria-label="App status">
        <span class="dot" aria-hidden="true"></span>
        <span>White background • Modern UI</span>
      </div>
    </div>

    <div class="grid">
      <!-- Left: Input -->
      <section class="card" aria-labelledby="input-title">
        <div class="card-header">
          <h2 class="card-title" id="input-title">Prompt Template</h2>
        </div>
        <div class="card-body">
          <label for="inputText">Input Prompt Template</label>
          <textarea id="inputText" placeholder="Input Prompt Template Here"></textarea>

          <div class="row">
            <button class="btn btn-primary" onclick="convert()" id="generateBtn">Generate Bookmarklet</button>
            <button class="btn btn-ghost" onclick="clearAll()">Clear</button>
          </div>

          <p class="help">
            Tip: Keep your template readable. Each new line will be inserted as a new paragraph in the ChatGPT input area.
          </p>

          <div id="statusBox" class="status" role="status" aria-live="polite"></div>
        </div>
      </section>

      <!-- Right: Output -->
      <section class="card" aria-labelledby="output-title">
        <div class="card-header">
          <h2 class="card-title" id="output-title">Bookmarklet</h2>
        </div>
        <div class="card-body">
          <div class="pill" style="width: 100%; justify-content: space-between; gap: 12px;">
            <a href="about:blank" id="outputAnchor" class="bookmarklet-link" draggable="true">
              <span aria-hidden="true">↗</span>
              <span>bookmarklet</span>
            </a>

            <button class="btn" onclick="copyBookmarklet()" id="copyBtn" disabled>
              Copy URL
            </button>
          </div>

          <div style="display: none;" id="workDiv"></div>

          <div style="margin-top: 12px;">
            <label for="outputText">Bookmarklet URL</label>
            <textarea id="outputText" placeholder="Bookmarklet Here" readonly></textarea>
          </div>

          <div class="footer-note">
            If the bookmarklet does nothing, ensure you are on the ChatGPT page and the message input exists as <code>#prompt-textarea</code>.
          </div>
        </div>
      </section>
    </div>
  </div>

  <script>
    function setStatus(type, message) {
      const box = document.getElementById("statusBox");
      box.className = "status " + (type === "ok" ? "ok" : "err");
      box.textContent = message;
    }

    function clearStatus() {
      const box = document.getElementById("statusBox");
      box.className = "status";
      box.textContent = "";
    }

    function clearAll() {
      document.getElementById("inputText").value = "";
      document.getElementById("outputText").value = "";
      const a = document.getElementById("outputAnchor");
      a.href = "about:blank";
      document.getElementById("copyBtn").disabled = true;
      clearStatus();
    }

    function convert() {
      clearStatus();

      const input = document.getElementById("inputText").value;

      if (!input.trim()) {
        setStatus("err", "Please input a prompt template first.");
        return;
      }

      const jsCode =
        "!async function(){const sleep=msec=>new Promise(r=>setTimeout(r,msec));" +
        "const promptTextarea=document.querySelector(\"#prompt-textarea\");" +
        "if(!promptTextarea){alert(\"#prompt-textarea not found. Open ChatGPT and click into the message box first.\");return;}" +
        "const childNodesSaved=Array.from(promptTextarea.childNodes);" +
        "const promptInputList=" + JSON.stringify(input.split(/\r?\n/)) + ";" +
        "for(const promptLine of promptInputList){const p=document.createElement(\"p\");" +
        "if(\"\"==promptLine){const br=document.createElement(\"br\");p.appendChild(br)}" +
        "else p.textContent=promptLine;promptTextarea.appendChild(p)}" +
        "for(const childNodeSaved of childNodesSaved){promptTextarea.removeChild(childNodeSaved);promptTextarea.appendChild(childNodeSaved);}" +
        "await sleep(0);promptTextarea.lastChild&&promptTextarea.lastChild.scrollIntoView();}();";

      const bookmarkletUrl =
        "javascript:" + jsCode.replaceAll("%", "%25").replaceAll("\"", "%22");

      document.getElementById("outputText").value = bookmarkletUrl;

      const outputAnchor = document.getElementById("outputAnchor");
      outputAnchor.href = bookmarkletUrl;

      document.getElementById("copyBtn").disabled = false;
      setStatus("ok", "Generated. Drag the “bookmarklet” link to your bookmarks bar, or copy the URL.");
    }

    async function copyBookmarklet() {
      const text = document.getElementById("outputText").value;
      if (!text) return;

      try {
        await navigator.clipboard.writeText(text);
        setStatus("ok", "Copied to clipboard.");
      } catch (e) {
        // Fallback
        const output = document.getElementById("outputText");
        output.focus();
        output.select();
        document.execCommand("copy");
        setStatus("ok", "Copied to clipboard (fallback).");
      }
    }
  </script>
  </main>
</body>
</html>
